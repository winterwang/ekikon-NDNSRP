<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Mining the National Diet and Nutrition Survey Rolling Programme (NDNS RP) data</title>
    <meta charset="utf-8" />
    <meta name="author" content="王　超辰 | Chaochen Wang" />
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Mining the National Diet and Nutrition Survey Rolling Programme (NDNS RP) data
## Where, when, what you eat.
### 王　超辰 | Chaochen Wang
### 2019-09-17 18:00~19:30 <span class="citation">@AMU</span>・疫学懇話会

---





class: middle

# Outline of today's talk 

--
### Correspondence analyses:


- Relationship between **food consumed** and **eating location** for UK adolescents


- Relationship between **food consumed** and **eating time** for UK adults according to their diabetes status 

--

### Multilevel Latent Class Analysis:

- Relationship between **carbohydrate consumption** and **eating time** for UK adults. 

---
class: middle

# Some intuition about correspondence analysis  (CA)

--
- CA is a method for investigating the relationship in a **two-dimensional contingency table**.

- For example, the following table gives the frequency of consumption of three healthy food groups at each location in the NDNS RP data among teenagers (age: 11~19 years):

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 613 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 201 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 909 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 455 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2595 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 839 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3889 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 698 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6122 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 376 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7196 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1248 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9330 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1416 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11994 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
class: middle 

## Usually, we will conduct a `\(\chi^2\)` test. 

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 613 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 201 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 909 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 455 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2595 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 839 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3889 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 698 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6122 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 376 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7196 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1248 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9330 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1416 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11994 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


$$
\chi^2 = \sum\frac{(\text{Observed} - \text{Expected})^2}{\text{Expected}} \sim \chi^2_{(m -1)\times(n-1)}
$$

--
### To look for evidence against the null hypothesis that **there is no difference across the columns or rows**.

---
class: middle
# Hypothesis of independence

The null hypothesis of no difference across the columns or rows is also called:

.pull-left[
- Hypothesis of independence 
]

.pull-right[
- Homogeneity assumption
]


```r
chisq.test(freqtab)
```

```
## 
## 	Pearson's Chi-squared test
## 
## data:  freqtab
## X-squared = 792.56, df = 4, p-value &lt; 2.2e-16
```


We conclude that **there is dependency between the columns (food groups) and the rows (locations)**. 

---
class: middle

## But what exactly does this dependency mean?


&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 613 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 201 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 909 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 455 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2595 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 839 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3889 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 698 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6122 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 376 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7196 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1248 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9330 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1416 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11994 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

### Can we get **more information** from this contingency table? How?

--
### Yes! we can visualize their relationships!


---
class: middle 

## Step 1 - convert the frequency cell to proportions

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Matrix X. Observed Cell Proportions&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; r: row masses &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0079 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0511 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0168 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0758 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0379 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2160 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0700 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.3240 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0582 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.5100 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0313 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; c: col masses &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.1040 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.7780 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.1180 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- Row masses: `\(\mathbf{r} = \mathbf{X1}\)` 


```r
r &lt;- Xp %*% matrix(c(1, 1, 1), nrow = 3)
```

- Column masses: `\(\mathbf{c} = \mathbf{X}^T\mathbf{1}\)`


```r
c &lt;- t(Xp)  %*% matrix(c(1, 1, 1), nrow = 3)
```

---
class: middle 
## Step 2 - The variation (residuals) of each cell in matrix X from its expected value

`$$\text{Deviation} = \mathbf{X} - \mathbf{rc}^T$$`

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Deviations from Expected&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00003 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.00785 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00781 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.00000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00420 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03587 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.03167 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.00423 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04371 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03948 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00000 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00000 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.00000 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Big positive (negative) numbers means a strong positive (negative) relationship.

???
The residuals quantify the difference between the observed data and the data we would expect under the assumption that there is no relationship between the row and column categories of the table.

---
class: middle

## Step 3 - Standardise the residual for fair comparison (Z score)

$$
\mathbf{Z}  = \mathbf{D}_r^{-\frac{1}{2}} \times \text{Deviation} \times \mathbf{D}_c^{-\frac{1}{2}}
$$
&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Standardised Residuals Table&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; School_work &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00039 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03231 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.08258 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.02285 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.07142 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.16188 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.01694 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.06399 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.14835 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


???
These standardized residuals are z-scores.  This means that values of more than 1.96, or less than -1.96, are significant at the 0.05 level. For binary variables, their standard deviation is the square root of their expected values. 


---
class: middle

## Step 4 - Single Value Decomposition

$$
\mathbf{Z} = \mathbf{UD}_\lambda \mathbf{V}^T
$$

Where, 

- `\(\mathbf{Z}\)`: the standardised deviation matrix; 
- `\(\mathbf{U}\)`: the left singular vectors of `\(\mathbf{Z}\)` &lt;br&gt; (principal axes of food groups space **for projection of locations**); 
- `\(\mathbf{D}_\lambda\)`: singular values matrix;
- `\(\mathbf{V}^T\)`: right singular vectors of `\(\mathbf{Z}\)`&lt;br&gt; (principal axes of location space **for projection of food groups**).

--
#### Reminder in principle component analysis (PCA)  - Spectral decomposition

$$
\mathbf{S} = \mathbf{P}\Lambda\mathbf{P}^T
$$

#### It is easy to prove that 

$$
\mathbf{D}_\lambda^2 = \Lambda
$$

???

- S is the variance covariance matrhx 
- Lambda is the diagonal eigenvalue matrix 
- P is orthogonal projection matrix with new coordinates for the rotated new variables

---
class: middle
## Step 4 - Single Value Decomposition

$$
`\begin{aligned}
\mathbf{Z}  &amp; = \mathbf{UD}_\lambda \mathbf{V}^T \\ 
\mathbf{Z}  &amp; = \left[\begin{matrix}
0.00039&amp;-0.032&amp;0.083\\
0.02285&amp;-0.071&amp;0.162\\
-0.01694&amp;0.064&amp;-0.148
\end{matrix}\right] \\
= \left[\begin{matrix}
-0.34&amp;0.8980&amp;0.28\\
-0.69&amp;-0.4400&amp;0.57\\
0.63&amp;0.0043&amp;0.77
\end{matrix}\right]&amp; 
\left(\begin{matrix}
0.26&amp;0&amp;0\\
0&amp;0.01&amp;0\\
0&amp;0&amp;0
\end{matrix}\right) 
\left[\begin{matrix}
-0.10&amp;-0.94&amp;0.32\\
0.39&amp;0.26&amp;0.88\\
-0.91&amp;0.22&amp;0.34
\end{matrix}\right]\\
\end{aligned}`
$$

In R, simply do 


```r
svd(z)
```


---
class: middle 

## Step 5 - Calculate row profile, and column profile, centre them

.pull-left[

- Percentages of location for each food was eaten:

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Matrix R. Row Profile&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; School_work &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 0.1050 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6740 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2210 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 0.1170 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6670 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2160 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 0.0970 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.8510 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0523 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

$$
`\begin{aligned}
\mathbf{R} &amp; = \mathbf{D}^{-1}_r\mathbf{X} \\
\mathbf{R} &amp;\; - \mathbf{1c}^T
\end{aligned}`
$$
]

.pull-right[
- Percentages of food was eaten at each location:

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Matrix C. Column Profile&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Others &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Home &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; School &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0761 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0657 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.1420 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.3650 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2780 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.5930 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.5590 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6560 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2660 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
$$
`\begin{aligned}
\mathbf{C} &amp; = \mathbf{D}^{-1}_r\mathbf{X}^T \\
\mathbf{C} &amp;\; - \mathbf{1r}^T
\end{aligned}`
$$

]


---
class: middle 

## Step 6 - Find principal coordinates for rows and columns

.pull-left[
- Project the centred row profiles (food groups) onto to principal axes of locations `\(\mathbf{V}\)`
$$ 
F = (\mathbf{R} - \mathbf{1c}^T)(\mathbf{D}_c^{-1})(\mathbf{D}_c^{\frac{1}{2}}\mathbf{V})
$$

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Matrix F: Principal Coordinates for Rows&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Horizontal &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Vertical &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.3203 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0339 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.3132 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.0080 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2097 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0001 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.pull-right[

- Project the centred column prifiles (locations) onto principal axes of food groups `\(\mathbf{U}\)`

$$ 
G = (\mathbf{C} - \mathbf{1r}^T)(\mathbf{D}_r^{-1})(\mathbf{D}_r^{\frac{1}{2}}\mathbf{U})
$$

&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Matrix G: Principal Coordinates for Columns&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Horizontal &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Vertical &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Others &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.0828 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.0303 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Home &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.1147 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0031 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; School_work &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.6827 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0066 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


]


---
class: middle 

## Step 7 - standardise the coordinates


.pull-left[
$$
\text{Rows} = \mathbf{FD}_\lambda^{-\frac{1}{2}} \\
$$
]

.pull-right[
$$
\text{Columns} = \mathbf{G}\mathbf{D}_\lambda^{-\frac{1}{2}}
$$
]



&lt;table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Standar Normalised Coordinates for Rows and Columns&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Horizontal &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Vertical &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Brown Bread &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.6320 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.3325 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Fruit &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.6180 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.0788 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Veg not raw &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.4138 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0006 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Others &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.1634 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.2973 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Home &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2263 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0299 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; School_work &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -1.3471 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.0649 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: middle 





&lt;img src="index_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;


---
class: middle
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(60000);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
